<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Recipie Box</title>

	<style>

		/** {
			margin: 0px;
		}*/
		
		h2#heading {
			text-align: center;
			margin-top: 16px;
		}

		#profile-link {	
			left: calc(50% - 60px);
			position: absolute;
			bottom: 16px;
		}

		#code-link {
			left: calc(50% + 5px);
			position: absolute;
			bottom: 14px;
		}

		#code-link img {
			height: 60px;
			width: 60px;
		}

		#profile-link img {
			height: 52px;
			width: 52px;
		}

	</style>

	<script src="https://code.jquery.com/jquery-2.2.2.min.js"></script>

	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>

	<script src="../static/js/react/react.js"></script>
    <script src="../static/js/react/react-dom.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.24/browser.min.js"></script>

</head>

<body>
	<h2 id="heading">RECIPIE BOX</h2>

  	<div id="content" class="row">
  		
<!-- 		<div class="panel-group col-md-10 col-md-offset-1" id="accordion">

		  <div class="panel panel-default">
		    <div class="panel-heading">
		      <h4 class="panel-title">
		        <a data-toggle="collapse" data-parent="#accordion" href="#collapse1">
		        Collapsible Group 1</a>
		      </h4>
		    </div>
		    <div id="collapse1" class="panel-collapse collapse">
		      <div class="panel-body">
				<h4>Ingredients</h4>
				<hr>
				<ul class="list-group">
					<li class="list-group-item">Eggs</li>
					<li class="list-group-item">Olive Oil</li>
					<li class="list-group-item">Duck</li>
				</ul>
				<div class="btn btn-danger">DELETE</div>
				<div class="btn btn-primary">EDIT</div>
		      </div>
		    </div>
		  </div> -->
<!-- 		  	  <div class="panel panel-default">
		    <div class="panel-heading">
		      <h4 class="panel-title">
		        <a data-toggle="collapse" data-parent="#accordion" href="#collapse2">
		        Collapsible Group 2</a>
		      </h4>
		    </div>
		    <div id="collapse2" class="panel-collapse collapse">
		      <div class="panel-body">
				<h4>Ingredients</h4>
				<hr>
				<ul class="list-group">
					<li class="list-group-item">Eggs</li>
					<li class="list-group-item">Olive Oil</li>
					<li class="list-group-item">Duck</li>
				</ul>
				<div class="btn btn-danger">DELETE</div>
				<div class="btn btn-primary">EDIT</div>
		      </div>
		    </div>
		  </div> -->

		<!-- </div> -->

  	</div>

  	<div class="btn btn-primary col-md-offset-10"  data-toggle="modal" data-target="#new-item-modal">Add Recipie</div>

  	<div id="new-item-modal" class="modal fade" role="dialog">
	  <div class="modal-dialog">
	    <div class="modal-content">
	      <div class="modal-header">
	        <button type="button" class="close" data-dismiss="modal">&times;</button>
	        <h4 class="modal-title">Add new recipie</h4>
	      </div>
	      <div class="modal-body">
	        <form role="form">
			  <div class="form-group">
			    <label for="recipie-name-input">Recipie Name:</label>
			    <input type="text" class="form-control" id="recipie-name-input" placeholder="Name">
			  </div>
			  <div class="form-group">
			    <label for="recipie-ing-input">Ingredients:</label>
			    <textarea class="form-control" rows="2" id="recipie-ing-input" placeholder="Enter Ingredients seperated by commas."></textarea>
			  </div>
			</form>
	      </div>
	      <div class="modal-footer">
			<button class="btn btn-primary" data-dismiss="modal" id="new-item-modal-save">Save</button>
	        <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
	      </div>
	    </div>

	  </div>
	</div>

  	<div id="link-div">
  		<a href="https://github.com/aedorado/fcc-react" id="code-link"><img src="../static/svg/github.svg"></a>
  		<a href="http://aedorado.github.io" id="profile-link"><img src="../static/svg/github-face.svg"></a>
 	</div>
</body>

<script type="text/babel">

	var RboxItemHead = React.createClass({
		render: function() {
			var collhref = "#collapse" + this.props.pos;
			return (
				<div className="panel-heading">
				   	<h4 className="panel-title">
				       	<a data-toggle="collapse" data-parent="#accordion" href={collhref}>{this.props.name}</a>
				   	</h4>
				</div>
			);
		}
	});

	var RboxItemBodyElement = React.createClass({
		render: function() {
			return (
				<li className="list-group-item">{this.props.data}</li>
			)
		}
	});

	var RboxItemBody = React.createClass({
		remove: function() {
			var that = this;
			var rbjson = JSON.parse(localStorage.getItem('recipiebox')) || [];
			rbjson = rbjson.filter(function(obj) {
    			return obj.name !== that.props.data.name;
			});
			localStorage.setItem('recipiebox', JSON.stringify(rbjson));
			update();
		},

		render: function() {
			var collid = "collapse" + this.props.pos;
			var rows = [];
			this.props.data.ing.split(',').forEach(function(itemname, i) {
				rows.push(<RboxItemBodyElement data={itemname} key={i} />);
			})


			return (
			    <div id={collid} className="panel-collapse collapse">
			    	<div className="panel-body">
						<h4>Ingredients</h4>
						<hr />
						<ul className="list-group">{rows}</ul>
						<div className="btn btn-primary">EDIT</div>
						<div className="btn btn-danger" onClick={this.remove}>DELETE</div> 
			    	</div>
			    </div>
			);
		}
	});

	var RboxItem = React.createClass({

		render: function() {
			// console.log(this.props.data.ing);
			return (
				<div className="panel panel-default">
					<RboxItemHead name={this.props.data.name} pos={this.props.pos} />
					<RboxItemBody data={this.props.data} pos={this.props.pos} />
			    </div>
			);
		}

	});

	var Rbox = React.createClass({

		getInitialState: function() {
			return {
				data: JSON.parse(localStorage.getItem('recipiebox')) || []
			}
		},

		componentDidMount: function() {
			document.getElementById("new-item-modal-save").addEventListener('click', this.update, false);	
		},

		update: function() {
			// console.log($('#recipie-name-input').val(), $('#recipie-ing-input').val());
			var rbjson = JSON.parse(localStorage.getItem('recipiebox')) || [];
			rbjson.push({name: $('#recipie-name-input').val(), ing: $('#recipie-ing-input').val()});
			localStorage.setItem('recipiebox', JSON.stringify(rbjson));
			console.log(rbjson);
			this.setState({ data: JSON.parse(localStorage.getItem('recipiebox')) });
		},

		render: function() {
			var content = [];
			var rbjson = this.state.data;

			rbjson.forEach(function(data, i) {
				content.push(<RboxItem data={data} key={i} pos={i} />);
			});

			return (
				<div className="panel-group col-md-10 col-md-offset-1" id="accordion">{content}</div>
			);
		}

	});

	function update() {
		ReactDOM.render(<Rbox />, document.getElementById('content'));
	}

	update();

</script>

</html>